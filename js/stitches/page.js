/*!
 * Stitches - HTML5 Sprite Generator
 * http://draeton.github.com/Stitches
 *
 * Copyright 2011, Matthew Cobbs
 * Licensed under the MIT license.
 */
(function(a,c,b){c.Page=(function(){return{init:function(){c.Page.dropbox=b("#dropbox").get(0);c.Page.$droplabel=b("#droplabel");c.Page.$filelist=b("#filelist");c.Page.$buttons=b("#buttons");c.Page.buttons={$generate:b("a.generate"),$clear:b("a.clear"),$sprite:b("a.sprite"),$stylesheet:b("a.stylesheet")};c.Page.bindHandlers()},bindHandlers:function(){c.Page.dropbox.addEventListener("dragenter",c.Page.noopHandler,false);c.Page.dropbox.addEventListener("dragexit",c.Page.noopHandler,false);c.Page.dropbox.addEventListener("dragover",c.Page.noopHandler,false);c.Page.dropbox.addEventListener("drop",c.Page.drop,false);c.Page.$buttons.delegate("a","click",c.Page.handleButtons);c.Page.$filelist.delegate("a.remove","click",c.Page.removeFile)},handleButtons:function(d){if(/disabled/.test(this.className)){return false}if(/generate/.test(this.className)){c.Page.toggleButtons("add",["generate","clear"]);c.generateStitches();c.Page.toggleButtons("remove",["generate","clear"]);return false}if(/clear/.test(this.className)){c.Page.clearFiles();return false}return true},toggleButtons:function(e,d){d.forEach(function(g,f){c.Page.buttons["$"+g][e+"Class"]("disabled")})},noopHandler:function(d){d.stopPropagation();d.preventDefault()},drop:function(d){d.stopPropagation();d.preventDefault();var e=d.dataTransfer.files;if(e.length>0){c.Page.handleFiles(e)}},handleFiles:function(g){c.filesQueue=0;for(var f=0,d=g.length;f<d;f++){var e=g[f];if(/jpeg|png|gif/.test(e.type)){c.Page.addFile(e)}}},addFile:function(e){c.filesCount++;c.filesQueue++;c.Page.toggleButtons("add",["generate","clear","sprite","stylesheet"]);if(c.filesCount===1){c.Page.$droplabel.fadeOut("fast")}var d=new FileReader();d.onloadend=c.Page.handleFileLoad.bind(e);d.readAsDataURL(e)},handleFileLoad:function(d){c.filesQueue--;var e=new c.Icon(this.name,d.target.result);var f=b(b.tmpl("icon_tmpl",e)).data("icon",e);c.Page.$filelist.append(f);f.fadeIn("fast");if(c.filesQueue===0){c.Page.toggleButtons("remove",["generate","clear"])}},removeFile:function(d){c.Page.toggleButtons("add",["sprite","stylesheet"]);b(this).parent().fadeOut("fast",function(){b(this).remove()});c.filesCount--;if(c.filesCount===0){c.Page.toggleButtons("add",["generate","clear"]);c.Page.$droplabel.fadeIn("fast")}return false},clearFiles:function(){c.Page.$filelist.find("a.remove").each(function(){c.Page.removeFile.bind(this)()})}}})()})(window,Stitches,jQuery);