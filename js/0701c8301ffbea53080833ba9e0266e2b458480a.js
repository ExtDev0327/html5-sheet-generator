/*!
 * Stitches - HTML5 Sprite Generator
 * http://draeton.github.com/Stitches
 *
 * Copyright 2011, Matthew Cobbs
 * Licensed under the MIT license.
 */
(function(a){a.Stitches=(function(){return{init:function(b){Stitches.filesCount=0;Stitches.Page.init(b)},generateStitches:function(){Stitches.looseIcons=[];Stitches.placedIcons=[];Stitches.Page.$filelist.find("li").each(function(){var d=$(this).data("icon");Stitches.looseIcons.push(d)});Stitches.positionImages();var c=Stitches.makeStitches();var b=Stitches.makeStylesheet();Stitches.Page.buttons.$sprite.attr("href",c);Stitches.Page.buttons.$stylesheet.attr("href",b);Stitches.Page.toggleButtons("remove",["sprite","stylesheet"])},positionImages:function(){Stitches.looseIcons.forEach(function(c,b){c.x=c.y=0;c.isPlaced=false});Stitches.looseIcons=Stitches.looseIcons.sort(function(d,c){return c.area-d.area});Stitches.canvas=Stitches.Icons.idealCanvas(Stitches.looseIcons);Stitches.Icons.placeIcons(Stitches.looseIcons,Stitches.placedIcons,Stitches.canvas);Stitches.Icons.cropCanvas(Stitches.placedIcons,Stitches.canvas)},makeStitches:function(){var b=Stitches.canvas.getContext("2d");Stitches.placedIcons.forEach(function(d,c){b.drawImage(d.image,d.x,d.y)});return Stitches.canvas.toDataURL()},makeStylesheet:function(){Stitches.placedIcons=Stitches.placedIcons.sort(function(d,c){return d.name<c.name?-1:1});var b="";b+=".sprite {\n";b+="    background: url(sprite.png) no-repeat;\n";b+="}\n\n";Stitches.placedIcons.forEach(function(d,c){b+=".sprite-"+d.name+" {\n";b+="    width: "+d.width+"px;\n";b+="    height: "+d.height+"px;\n";b+="    background-position: -"+d.x+"px -"+d.y+"px;\n";b+="}\n\n"});return"data:,"+encodeURIComponent(b)}}})()})(window);/*!
 * Stitches.Page
 * http://draeton.github.com/Stitches
 *
 * Copyright 2011, Matthew Cobbs
 * Licensed under the MIT license.
 */
(function(a,c,b){(function(){var e={};c.tmpl=function d(h,g){var f=!/\W/.test(h)?e[h]=e[h]||d(document.getElementById(h).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+h.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return g?f(g):f}})();c.Page=(function(){return{init:function(d){if(!d){d=b("<div>").appendTo("body")}c.Page.$elem=d;c.Page.getTemplates()},getTemplates:function(){b.get("js/mylibs/stitches/templates.html",function(e){b("body").append(e);c.Page.templates.stitches=c.tmpl("stitches_tmpl");c.Page.templates.icon=c.tmpl("stitches_icon_tmpl");var d=b(c.tmpl(c.Page.templates.stitches,{}));d.appendTo(c.Page.$elem);c.Page.setReferences()})},setReferences:function(){c.Page.dropbox=b(".dropbox",c.Page.$elem).get(0);c.Page.$droplabel=b(".droplabel",c.Page.$elem);c.Page.$filelist=b(".filelist",c.Page.$elem);c.Page.$buttons=b(".buttons",c.Page.$elem);c.Page.buttons={$generate:b("a.generate",c.Page.$buttons),$clear:b("a.clear",c.Page.$buttons),$sprite:b("a.dlsprite".Stitches.Page.$buttons),$stylesheet:b("a.dlstylesheet",c.Page.$buttons)};c.Page.bindHandlers()},bindHandlers:function(){c.Page.dropbox.addEventListener("dragenter",c.Page.noopHandler,false);c.Page.dropbox.addEventListener("dragexit",c.Page.noopHandler,false);c.Page.dropbox.addEventListener("dragover",c.Page.noopHandler,false);c.Page.dropbox.addEventListener("drop",c.Page.drop,false);c.Page.$buttons.delegate("a","click",c.Page.handleButtons);c.Page.$filelist.delegate("a.remove","click",c.Page.removeFile)},handleButtons:function(d){if(/disabled/.test(this.className)){return false}if(/generate/.test(this.className)){c.Page.setButtonDisabled(true,["generate","clear"]);c.generateStitches();c.Page.setButtonDisabled(false,["generate","clear"]);return false}if(/clear/.test(this.className)){c.Page.clearFiles();return false}return true},setButtonDisabled:function(d,e){var f=d?"add":"remove";e.forEach(function(h,g){c.Page.buttons["$"+h][f+"Class"]("disabled")})},noopHandler:function(d){d.stopPropagation();d.preventDefault()},drop:function(d){d.stopPropagation();d.preventDefault();var e=d.dataTransfer.files;if(e.length>0){c.Page.handleFiles(e)}},handleFiles:function(g){c.filesQueue=0;for(var f=0,d=g.length;f<d;f++){var e=g[f];if(/jpeg|png|gif/.test(e.type)){c.Page.addFile(e)}}},addFile:function(e){c.filesCount++;c.filesQueue++;c.Page.setButtonDisabled(true,["generate","clear","sprite","stylesheet"]);if(c.filesCount===1){c.Page.$droplabel.fadeOut("fast")}var d=new FileReader();d.onloadend=c.Page.handleFileLoad.bind(e);d.readAsDataURL(e)},handleFileLoad:function(d){c.filesQueue--;var e=new c.Icon(this.name,d.target.result);var f=b(c.tmpl(c.Page.templates.icon,e)).data("icon",e);c.Page.$filelist.append(f);f.fadeIn("fast");if(c.filesQueue===0){c.Page.setButtonDisabled(false,["generate","clear"])}},removeFile:function(d){c.Page.setButtonDisabled(true,["sprite","stylesheet"]);b(this).parent().fadeOut("fast",function(){b(this).remove()});c.filesCount--;if(c.filesCount===0){c.Page.setButtonDisabled(true,["generate","clear"]);c.Page.$droplabel.fadeIn("fast")}return false},clearFiles:function(){c.Page.$filelist.find("a.remove").each(function(){c.Page.removeFile.bind(this)()})}}})()})(window,Stitches,jQuery);/*!
 * Stitches.Icon
 * http://draeton.github.com/Stitches
 *
 * Copyright 2011, Matthew Cobbs
 * Licensed under the MIT license.
 */
(function(b,c){var a=0;c.Icon=function(f,g,d){var e=this;this.guid=a++;this.name=f.replace(/\.|\s+/gi,"-");this.image=new Image();this.image.onload=function(){e.x=0;e.y=0;e.width=e.image.width;e.height=e.image.height;e.area=e.width*e.height;if(d){d(e)}};this.image.src=g}})(window,Stitches);/*!
 * Stitches.Icons
 * http://draeton.github.com/Stitches
 *
 * Copyright 2011, Matthew Cobbs
 * Licensed under the MIT license.
 */
(function(b,c){var a=b.document;c.Icons=(function(){return{idealCanvas:function(i){var k=0;var f=0;var j=0;i.forEach(function(m,l){k=m.width>k?m.width:k;f=m.height>f?m.height:f;j+=m.area});var e=Math.ceil(Math.sqrt(j));var d=k>e?k:e;var h=f>e?f:e;var g=a.createElement("canvas");g.width=d;g.height=h;return g},placeIcons:function(g,f,d){var e=0;while(g.length&&e<10){g.forEach(function(i,h){if(!i.isPlaced){i.isPlaced=c.Icons.placeIcon(i,f,d)}});e++}for(e=0;e<g.length;e++){if(g[e].isPlaced){g.splice(e)}}return true},placeIcon:function(h,j,f){var g=0;while(g<2){for(var k=0;k<=f.height-h.height;k++){for(var d=0;d<=f.width-h.width;d++){h.x=d;h.y=k;var e=c.Icons.isOverlapped(h,j);if(!e){return true}d=e.x+e.width}k=e.y+e.height}f.width+=h.width;f.height+=h.height;g++}return false},isOverlapped:function(j,k){var g,f,i,h;var d=[];var e=null;k.forEach(function(m,l){g=(m.x<j.x+j.width);f=(m.x+m.width>j.x);i=(m.y<j.y+j.height);h=(m.y+m.height>j.y);if(g&&f&&i&&h){d.push(m)}});if(d.length){e=d.pop()}else{k.push(j)}return e},cropCanvas:function(g,e){var d=0,f=0;g.forEach(function(i,h){d=d>i.x+i.width?d:i.x+i.width;f=f>i.y+i.height?f:i.y+i.height});e.width=d;e.height=f}}})()})(window,Stitches);window.log=function(){log.history=log.history||[];log.history.push(arguments);if(this.console){arguments.callee=arguments.callee.caller;var a=[].slice.call(arguments);(typeof console.log==="object"?log.apply.call(console.log,console,a):console.log.apply(console,a))}};(function(e){function h(){}for(var g="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,timeStamp,profile,profileEnd,time,timeEnd,trace,warn".split(","),f;f=g.pop();){e[f]=e[f]||h}})((function(){try{console.log();return window.console}catch(a){return window.console={}}})());/*!
 * Snippets
 */
(function(b,c){var a=b("#stitches");c.init(a)}(jQuery,Stitches));